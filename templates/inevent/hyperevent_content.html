{% extends "inevent/base.html" %}
 
{% block extrastyle_inevent_page %}
	{% load dajaxice_templatetags %}
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="http://releases.flowplayer.org/5.3.2/skin/functional.css" />
	
	
	
{% endblock %}	
		
{% block extrascripts_inevent_page %}		
	<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
	<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51d54192080b635d"></script>
    <!-- <script src="{{ STATIC_URL }}klewelportal/scripts/bootstrap.min.js" type="text/javascript"></script> -->
	<script src="http://releases.flowplayer.org/js/flowplayer-3.2.12.min.js"></script>
	


{% endblock %}

{% load seconds %}

{% block menu_inevent_page %}
	<ul class="nav nav-pills">
		<li class="active">
			<a href="/inevent_portal">Home</a>
		</li>
	</ul>	
{% endblock %}
{% block content_inevent_page %}
<div class="row-fluid nihilo">
	<div class="container-fluid span12">
		<div class="row-fluid">
			<div class="col-fluid span9">
				<h1 id="center-element"> {{ hyperevent.title }} </h1>
			</div>

			<div class="col-fluid event-date pull-right span3" style="margin-top:25px;">
				{% if hyperevent.date %}
					<small class="pull-right"> <i class="icon-calendar"></i> {{ hyperevent.date|date:"D d M Y" }} </small>
				{% endif %}
			</div>
		</div>

		<div class="row-fluid">
			<div class="col-fluid span8">
				<!-- AddThis Button BEGIN -->
				<div class="col-fluid addthis_toolbox addthis_default_style span8" id="addthis">
					<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
					<a class="addthis_button_tweet"></a>
					<a class="addthis_button_pinterest_pinit"></a>
					<a class="addthis_counter addthis_pill_style"></a>
				</div>
				<!-- AddThis Button END -->
			

				<div class="col-fluid event-date pull-right span4">
					<button class="btn btn-info btn-small pull-right" id="graph_button" name="list"> Inter-event Navigation </button>
				</div>
			</div>
		</div>
		
		<div class="row-fluid">
			<div class="col-fluid span8">
				{% if hyperevent.description %}
					<p>{{ hyperevent.description }}</p>
				{% endif %}
			</div>
		</div>

		<div class="row-fluid">
			<div class="col-fluid span8">
				<!-- Display player and graph -->
				<iframe id='hePlayer' width="100%" height="700px" src='http://inevent.haifa.il.ibm.com/player.jsp?hyperEventId={{ hyperevent.id }}'style='border:none;'> </iframe>
				
				<div id="graph_container">
					<div class="tab-content well" style="display:none">
						<div id="graph"></div>
					</div>
				</div>
			</div>

			<div id="graph_params" class="col-fluid span4 well">
				<div id="graph_form" style="display:none;">
				
					<div class="nav-header">Graph parameters</div>

					<form action="" class="form-horizontal" method="post" id="filterform">
						<!--
						<div class="control-group">
							<label class="control-label" for="buttonMotCles">Keywords</label>
							<div class="controls"> 
								<div class="btn-group" data-toggle="buttons-radio">
									<select class="input-medium" placeholder=".input-medium">
										<option>Titre</option>
										<option>Description</option>
										<option>Transcription</option>
										<option>Slide</option> 
										<option>Tous</option>
									</select>
								</div>
								<input class="input-small" placeholder=".input-small" value=" " id="prependedDropdownButton" type="text">
							</div>
						</div>
						-->

						<div class="control-group">
							<label class="control-label" for="fader">Graph size</label>
							<div class="controls">
								<input onchange="start_graph()" id="user_size" class="input-medium" placeholder=".input-medium" type="range" min="50" max="500" step="50" value="50" id="fader2" list="volsettings"> <span id="user_size_text">0</span></input>
							</div>
						</div>

						<div class="control-group">
							<label class="control-label" for="fader2">Depth</label>
							<div class="controls">
								<input onchange="start_graph()" id="user_depth" class="input-medium" placeholder=".input-medium" type="range" min="1" max="6" step="1" value="2" id="fader2" list="volsettings"> <span id="user_depth_text">0</span></input>
							</div>
						</div>

						<div class="control-group">
							<label class="control-label" for="fader2">Neighbours</label>
							<div class="controls">
								<input onchange="start_graph()" id="user_neighbours" class="input-medium" placeholder=".input-medium" type="range" min="1" step="1" max="10" value="2" id="fader2" list="volsettings"> <span id="user_neighbours_text">0</span></input>
							</div>
						</div>

						<div class="control-group">
							<label class="control-label" for="radioButtonType">Relation Type</label>
							<div class="controls">
								<div class="btn-group" data-toggle="buttons-checkbox">
									<button type="button" class="btn btn-small">Content</button>
									<button type="button" class="btn btn-small">Emotions</button>
									<!--<button type="button" class="btn btn-primary">Popularit&eacute;</button>-->
								</div>
							</div>
						</div>
						
						<!--
						<div class="control-group">
							<label class="control-label" for="sourceButton">Source</label>
							<div class="controls">
								<div class="btn-group" data-toggle="buttons-radio">
									<select class="input-medium" placeholder=".input-medium">
										<option>All</option>
										<option>Klewel</option>
										<option>Ted</option>
										<option>Radvision</option>
									</select>
								</div>
							</div>
						</div>

						<div class="control-group">
							<label class="control-label">Start Date</label>
							<div class="controls">
								<div class="input-append date" id="dp5" data-date-format="dd/mm/yyyy">
									<input class="input-small" placeholder=".input-small" name="start_date" style="cursor:pointer" value="dd/mm/yyyy" type="text"><span class="add-on"><i class="icon-th"></i></span>
								</div>
							</div>
						</div>
	
						<div class="control-group">
							<label class="control-label">End Date</label>
							<div class="controls">
								<div class="input-append date" id="dp6" data-date-format="dd/mm/yyyy">
									<input class="input-small" placeholder=".input-small" name="end_date" style="cursor:pointer" value="dd/mm/yyyy" type="text"><span class="add-on"><i class="icon-th"></i></span>
								</div>
							</div>
						</div>
						-->
					</form>
				
				
				
				</div>
			
				<div class="row-fluid" id="related_talks">{% include "inevent/related_talks.html" with hyperevent_id=hyperevent.id  %}</div>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript">
 /*	$(document).ready(function() {
		if ($("#toggle_transcript").length>0){
			Dajaxice.inevent.get_transcript(display_transcript, {'transcript_url': "{{ hyperevent.transcript_url }}" },{'error_callback': 'error'});
			$("#toggle_transcript").click({label: 'toggle_transcript', target:'transcript' }, toggle_element);
		}
			
		
		if ($("#toggle_slides").length>0)
			$("#toggle_slides").on("click",{label: 'toggle_slides', target:'slides' }, toggle_element);
			
	});*/
	
	function toggle_element(event)   { 
	$("#"+event.data.target).toggleClass('hide');
	current_image = $("#"+event.data.label+" i");
	if (current_image.hasClass('icon-chevron-down')){
		current_image.removeClass('icon-chevron-down');
		current_image.addClass('icon-chevron-up');
	}
	else{
			current_image.removeClass('icon-chevron-up');
			current_image.addClass('icon-chevron-down');
	}		
}	


	

	function display_transcript(data) {
		if ($('#transcript').length>0){
			$('#transcript').html(data);
			$('#toggle_transcript').css('display', '');
		}
	
	}


	

	$('#graph_button').bind('click', get_graph);
	var graph_data_fetched = false;

	function get_graph(){
		if ($('#graph_button').attr("name") == "list") {
			$('#graph_container div.tab-content').css("display", "");
			if (graph_data_fetched == false) {
				//Dajaxice.inevent.get_graph(function(data){display_graph(data, true);},{'error_callback': display_graph_error});
				$('#graph').html('<div class="alert alert-info" style ="margin-top:100px;position:relative;margin-bottom:100px"> Work in progress...<br></br>The first time, it might take few minutes to load the most recents talks and their related ones. You may switch to other tabs and then come back. </div>');
				//$('#graph_button').prop('disabled', true);
			}
			$('#graph_button').attr("name","graph");
			$('#hePlayer').css("display", "none");
			
			//SD/ Toogle params/talks
			$('#related_talks').css("display", "none");
			$('#graph_form').css("display", "");
			
			$('#graph_button').html("Intra-event Navitation")
		}
		else {
			$('#graph_button').attr("name","list");
			
			//SD/ Toggle graph/player
			$('#hePlayer').css("display", "");
			$('#graph_container div.tab-content').css("display", "none");
			
			//SD/ Toogle params/talks
			$('#related_talks').css("display", "");
			$('#graph_form').css("display", "none");
			
			$('#graph_button').html("Inter-event Navigation")
		}
	}
	
	function start_graph() {
		video_switch = true ;
	
		max_neighbours = $("#user_neighbours").val() ;
		max_depth = $("#user_depth").val() ;
		max_size = $("#user_size").val() ;
		
		$("#user_neighbours_text").text(max_neighbours) ;
		$("#user_size_text").html(max_size) ;
		if(max_depth == 6)
			$("#user_depth_text").html(max_depth + "+") ;
		else
			$("#user_depth_text").html(max_depth) ;
		
		Dajaxice.inevent.get_event_head(
			function(data){display_graph_head(data, video_switch, max_neighbours, max_depth, max_size);},
			{'id': {{ hyperevent.id }}, 'error_callback': display_graph_error});
	}
	
	$(document).ready(function() {
		start_graph() ;
	});
</script>


{% endblock%}    

    
