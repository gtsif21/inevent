{% extends "inevent/base.html" %}
 
{% block extrastyle_inevent_page %}
	{% load dajaxice_templatetags %}
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="http://releases.flowplayer.org/5.3.2/skin/functional.css" />
	
	
	
{% endblock %}	
		
{% block extrascripts_inevent_page %}		
	<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
	<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51d54192080b635d"></script>
    <!-- <script src="{{ STATIC_URL }}klewelportal/scripts/bootstrap.min.js" type="text/javascript"></script> -->
	<script src="http://releases.flowplayer.org/js/flowplayer-3.2.12.min.js"></script>
	


{% endblock %}

{% load seconds %}

{% block menu_inevent_page %}
	<ul class="nav nav-pills">
		<li class="active">
			<a href="/inevent_portal">Home</a>
		</li>
	</ul>	
{% endblock %}
{% block content_inevent_page %}
<div class="row-fluid nihilo">
	<div class="container-fluid span12">
		<div class="row-fluid">
			<div class="col-fluid span9">
				<h1 id="center-element"> {{ hyperevent.title }} </h1>
			</div>

			<div class="col-fluid event-date pull-right span3" style="margin-top:25px;">
				{% if hyperevent.date %}
					<small class="pull-right"> <i class="icon-calendar"></i> {{ hyperevent.date|date:"D d M Y" }} </small>
				{% endif %}
			</div>
		</div>

		<div class="row-fluid">
			<div class="col-fluid span8">
				<!-- AddThis Button BEGIN -->
				<div class="col-fluid addthis_toolbox addthis_default_style span8" id="addthis">
					<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
					<a class="addthis_button_tweet"></a>
					<a class="addthis_button_pinterest_pinit"></a>
					<a class="addthis_counter addthis_pill_style"></a>
				</div>
				<!-- AddThis Button END -->
			

				<div class="col-fluid event-date pull-right span4">
					<button class="btn btn-info btn-small pull-right" id="graph_button" name="list"> Inter-event Navigation </button>
				</div>
			</div>
		</div>
		
		<div class="row-fluid">
			<div class="col-fluid span8">
				{% if hyperevent.description %}
					<p>{{ hyperevent.description }}</p>
				{% endif %}
			</div>
		</div>

		<div class="row-fluid">
			<div class="col-fluid span8">
				<!-- Display player and graph -->
				<iframe id='hePlayer' width="100%" height="700px" src='http://inevent.haifa.il.ibm.com/player.jsp?hyperEventId={{ hyperevent.id }}'style='border:none;'> </iframe>
				
				<div id="graph_container">
					<div class="tab-content well" style="display:none;">
						<div id="graph1"></div>
					</div>
					
					<!--
					<div class="tab-content well">
						<div id="graph2"></div>
					</div>
					-->
				</div>
			</div>

			<div id="graph_params" class="col-fluid span4 well">
				
				{% include "inevent/graph_params.html" with div_id="graph1" %}
				
				{# include "inevent/graph_params.html" with div_id="graph2" #}
				
				<div class="row-fluid" id="related_talks">{% include "inevent/related_talks.html" with hyperevent_id=hyperevent.id %}</div>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript">
 /*	$(document).ready(function() {
		if ($("#toggle_transcript").length>0){
			Dajaxice.inevent.get_transcript(display_transcript, {'transcript_url': "{{ hyperevent.transcript_url }}" },{'error_callback': 'error'});
			$("#toggle_transcript").click({label: 'toggle_transcript', target:'transcript' }, toggle_element);
		}
			
		
		if ($("#toggle_slides").length>0)
			$("#toggle_slides").on("click",{label: 'toggle_slides', target:'slides' }, toggle_element);
			
	});*/
	
	function toggle_element(event)   { 
	$("#"+event.data.target).toggleClass('hide');
	current_image = $("#"+event.data.label+" i");
	if (current_image.hasClass('icon-chevron-down')){
		current_image.removeClass('icon-chevron-down');
		current_image.addClass('icon-chevron-up');
	}
	else{
			current_image.removeClass('icon-chevron-up');
			current_image.addClass('icon-chevron-down');
	}		
}	


	

	function display_transcript(data) {
		if ($('#transcript').length>0){
			$('#transcript').html(data);
			$('#toggle_transcript').css('display', '');
		}
	
	}


	

	$('#graph_button').bind('click', get_graph);
	var graph_data_fetched = false;

	function get_graph(){
		if ($('#graph_button').attr("name") == "list") {
			$('#graph_container div.tab-content').css("display", "");
			if (graph_data_fetched == false) {
				//Dajaxice.inevent.get_graph(function(data){display_graph(data, true);},{'error_callback': display_graph_error});
				$('#graph1').html('<div class="alert alert-info" style ="margin-top:100px;position:relative;margin-bottom:100px"> Work in progress...<br></br>The first time, it might take few minutes to load the most recents talks and their related ones. You may switch to other tabs and then come back. </div>');
				//$('#graph_button').prop('disabled', true);
			}
			$('#graph_button').attr("name","graph");
			$('#hePlayer').css("display", "none");
			
			//SD/ Toogle params/talks
			$('#related_talks').css("display", "none");
			$('#graph1_form').css("display", "");
			
			$('#graph_button').html("Intra-event Navitation")
		}
		else {
			$('#graph_button').attr("name","list");
			
			//SD/ Toggle graph/player
			$('#hePlayer').css("display", "");
			$('#graph_container div.tab-content').css("display", "none");
			
			//SD/ Toogle params/talks
			$('#related_talks').css("display", "");
			$('#graph1_form').css("display", "none");
			
			$('#graph_button').html("Inter-event Navigation")
		}
	}
	
	function start_graph(div_id) {
		video_switch = true ;
		var graph = new Graph(div_id);
	
		max_neighbours = $("#" + div_id + "_form .user_neighbours").val() ;
		max_depth = $("#" + div_id + "_form .user_depth").val() ;
		max_size = $("#" + div_id + "_form .user_size").val() ;
		window["update_" + div_id + "_value"]() ;

		Dajaxice.inevent.get_event_head(
			function(data){graph.display_graph_head(data, video_switch, max_neighbours, max_depth, max_size);},
			{'id': {{ hyperevent.id }}, 'error_callback': display_graph_error});
	}

	$(document).ready(function() {
		var div_id = "graph1" ;

		$("#" + div_id + "_form .user_neighbours").val(1) ;
		$("#" + div_id + "_form .user_depth").val(1) ;
		$("#" + div_id + "_form .user_size").val(100) ;

		start_graph(div_id) ;
		//start_graph("graph2") ;
	});
</script>


{% endblock%}
