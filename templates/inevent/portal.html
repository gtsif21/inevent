{% extends "inevent/base.html" %}

{% block menu_inevent_page %}
<ul class="tabbable nav">
	<li class="active"><a href="#tab1" data-toggle="tab">Most Recent Talks</a></li>
	<!-- <li><a href="#tab2" data-toggle="tab">Most Popular Talks</a></li> -->
	<li href="#tab3" data-toggle="tab">
		{% include "search.html"  with search_form=search_form from="inevent" %}
	</li>
</ul>
{% endblock %}

{% block content_inevent_page %}
	<div class="tab-content">
		<div class="tab-pane active" id="tab1">
			<div class="row-fluid">
				<div class="col-fluid span8">
					<h3 id="portal-title">Most Recent Talks</h3>
				</div>
				<div class="col-fluid span4">
					<button class="btn btn-info btn-small" style="margin-top:auto;" id="graph_button" name="list"> View as Graph </button><br/><br/>
				</div>
			</div>
			
			<div class="row-fluid" id="recency">
				<div id="graph_container" class="tabbable well well-small span8">
					<div id="list">
						{% include "inevent/hyperevents_content.html"  with hyperevents=hyperevents %}
					</div>
				
					<div id="graph" style="display:none"></div>
				</div>
				
				<div class="col-fluid span4">
					<div id="graph_params" class="well" style="display:none;">
						{% include "inevent/graph_params.html" with div_id="graph" %}
					</div>
				</div>
			</div>
		</div>
		
		<!--
		<div class="tab-pane" id="tab2">
			<p> Coming Soon </p>
		</div>
		-->
		
		<div class="tab-pane" id="tab3">
			<div id="search_list"></div>
		</div>
	</div>
	
	<script type="text/javascript">
		$('#graph_button').bind('click', get_graph);
		var graph_data_fetched = false;

		function get_graph(){
			if ($('#graph_button').attr("name") == "list") {
				$('#graph').css("display", "");
				if (graph_data_fetched == false) {
					//Dajaxice.inevent.get_graph(function(data){display_graph(data, true);},{'error_callback': display_graph_error});
					$('#graph').html('<div class="alert alert-info" style ="margin-top:100px;position:relative;margin-bottom:100px"> Work in progress...<br></br>The first time, it might take few minutes to load the most recents talks and their related ones. You may switch to other tabs and then come back. </div>');
					//$('#graph_button').prop('disabled', true);
				}
				$('#graph_button').attr("name","graph");
				$('#list').css("display", "none");
				$('#graph_button').html("View as List") ;
				$('#graph_params').show() ;
			}
			else {
				$('#graph_button').attr("name","list");
				$('#list').css("display", "");
				$('#graph').css("display", "none");
				$('#graph_button').html("View as Graph");
				$('#graph_params').hide() ;
			}
		
		}

		function start_graph(div_id) {
			video_switch = false ;
			var graph = new Graph(div_id);
			
			max_neighbours = $("#" + div_id + "_form .user_neighbours").val() ;
			max_depth = $("#" + div_id + "_form .user_depth").val() ;
			max_size = $("#" + div_id + "_form .user_size").val() ;
			window["update_" + div_id + "_value"]() ;
		
			Dajaxice.inevent.get_graph_head(function(data){graph.display_graph_head(data, video_switch, max_neighbours, max_depth, max_size);},{'error_callback': display_graph_error});
		}

		$(document).ready(function() {
			div_id = "graph"
			
			$("#" + div_id + "_form .user_neighbours").val(3) ;
			$("#" + div_id + "_form .user_depth").val(3) ;
			$("#" + div_id + "_form .user_size").val(100) ;
			
			start_graph(div_id) ;
			$('#graph_form').show() ;
		});

		$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
			if ($(e.target).attr('href').indexOf("tab1")!=-1){
				$('#graph_button').css("display", "block");
				
				if($('#graph').css("display") == "block")
					$('#graph_params').css("display", "block");
			}
			else
				$('#graph_button').css("display", "none");
		})
	</script>
{% endblock%}
